@{
    ViewBag.Title = "Department Queues";
    Layout = "~/Views/Shared/_Layout3.cshtml";
    DateTime now = DateTime.Now;
    string today = now.Year.ToString() + "-" + now.Month.ToString() + "-" + now.Day.ToString();
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<h2 class="bg-primary"><b>@ViewBag.DeptName</b>, @today</h2>

@*<div class="bg-primary" style="font-size:24px; font-weight:bold" id="clock"></div>*@

<div class="row">
    <div class="col-md-12">
        <div id="queuesTable"></div>
    </div>
</div>
@section Scripts{
    <script src="~/Scripts/jquery.signalR-2.2.1.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <script type="text/javascript">
    $(function () {
        // Declare a proxy to reference the hub.
        var notifications = $.connection.queuesHub;

        //debugger;
        // Create a function that the hub can call to broadcast messages.
        notifications.client.updateDeptQueues = function () {
            getDeptQueues()

        };
        // Start the connection.
        $.connection.hub.start().done(function () {
            console.log("connection started");
            getDeptQueues();
        }).fail(function (e) {
            alert(e);
        });
    });


    function getDeptQueues()
    {
        var tbl = $('#queuesTable');
        $.ajax({
            url: '/Queues/GetDeptQueues/@ViewBag.DeptId',
            contentType: 'application/html ; charset:utf-8',
            type: 'GET',
            dataType: 'html',
            success: function (result) {
                tbl.empty().append(result);
            },
            error: function () {

            }
        });
        }







        //function updateClock() {
        //    var currentTime = new Date();
        //    var currentHours = currentTime.getHours();
        //    var currentMinutes = currentTime.getMinutes();
        //    var currentSeconds = currentTime.getSeconds();

        //    //// Pad the minutes and seconds with leading zeros, if required
        //    //currentMinutes = (currentMinutes  12 ) ? currentHours - 12 : currentHours;

        //    //// Convert an hours component of "0" to "12"
        //    //currentHours = (currentHours == 0) ? 12 : currentHours;

        //    // Compose the string for display
        //    var currentTimeString = currentHours + ":" + currentMinutes + ":" + currentSeconds;

        //    $("#clock").html(currentTimeString);

        //}

        //$(document).ready(function () {
        //    setInterval('updateClock()', 1000);
        //});




    //function PlaySound(soundObj) {
    //    var sound = document.getElementById(soundObj);
    //    sound.Play();
    //}

    //////$("body").on('DOMSubtreeModified', "mydiv", function () {
    //////    alert('aaaaa');
    //////});


    //////$('mydiv').on("DOMSubtreeModified", function () {
    //////    alert('changed');
    //////        //PlaySound("bellwav");
    //////});






    </script>
}


